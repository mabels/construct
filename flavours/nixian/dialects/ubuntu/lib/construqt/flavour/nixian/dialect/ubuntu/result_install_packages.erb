out << "install_packages()"
out << "{"
out << "packages=$*"
out << "updates=''"
out << 'for i in $packages'
out << 'do'
out << ' dpkg -l $i 2> /dev/null | grep -q "^ii\s\s*$i\s"'
out << ' if [ $? != 0 ]'
out << ' then'
out << '    updates="$updates $i"'
out << ' fi'
out << 'done'
out << '[ -f /etc/resolv.conf ] && mv /etc/resolv.conf /etc/resolv.conf.temp'
out << 'echo "nameserver 8.8.8.8" >> /etc/resolv.conf'
out << 'apt-get -qq -y install $updates'
out << 'if [ $? != 0 ]'
out << 'then'
out << '  apt-get update'
out << '  apt-get -qq -y install $updates'
out << 'fi'
out << '[ -f /etc/resolv.conf.temp ] && mv /etc/resolv.conf.temp /etc/resolv.conf'
out << '}'
