out = []
out << "import_fname()"
out << "{"
out << "  fname=$1"
out << "  IMPORT_FNAME='/'`dirname $fname`'/.'`basename $fname`'.import'"
out << "}"
out << "git_add()"
out << "{"
out << "  fname=$1"
out << "  owner=$2"
out << "  right=$3"
out << "  skip_git=$4"
out << "  import_fname $fname"
out << "  ifname=$IMPORT_FNAME"
out << "  chown $owner $ifname"
out << "  chmod $right $ifname"
out << "  if [ ! -f /$fname ]"
out << "  then"
out << "    mv $ifname /$fname"
out << "    echo created /$fname to $owner:$right skip_git $skip_git"
out << "  else"
out << "    diff -rq $ifname /$fname"
out << "    if [ $? != 0 ]"
out << "    then"
out << "      mv $ifname /$fname"
out << "      echo updated /$fname to $owner:$right skip_git $skip_git"
out << "    else"
out << "      rm $ifname"
out << "      echo unchanged /$fname to $owner:$right skip_git $skip_git"
out << "    fi"
out << '    if [ "$skip_git" = "false" ]'
out << "    then"
out << "      git --git-dir /root/construqt.git --work-tree=/ add /$fname"
out << "    fi"
out << "  fi"
out << "}"
out
