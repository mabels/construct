#!/bin/sh
basedir=/var/lib/docker/construqt/<%= docker.name %>
if [ -d $basedir ]
then
  echo "Basedir: $basedir"
  cd $basedir
fi
docker_name=run_<%= docker.name %>
docker build -t $docker_name .
exec docker run \
<% if docker.docker_deploy.get_privileged -%>
  --privileged \
<% end -%>
<% docker.interfaces.values.select{|i| i.name != "lo" }.each do |iface| -%>
  --net <%= iface.cable.connections.first.iface.name %> \
  <% iface.address.ips.each do |ip| -%>
    <% if ip.ipv4? -%>
    --ip=<%= ip.to_s %> \
    <% else -%>
    --ip6=<%= ip.to_s %> \
    <% end -%>
  <% end -%>
<% end -%>
<% docker.docker_deploy.get_maps.each do |h, d| -%>
  -v <%= h %>:<%= d %> \
<% end -%>
  -t $docker_name
